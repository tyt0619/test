软件安全（信息攻防）：
一个极具挑战性的领域
欢迎！
2

作战形式在变化
3

新型软件威胁形态（一）
政府行为：政府间互相攻击和获取情报
•震网利用了Windows USB驱动漏洞（CVE-2010-2568)、
文件
共享、0-day 打印机驱动漏洞及西门子开发平台的漏洞，破坏
了伊朗国家核设施。（2010年出现，2013年3月事件报导）
–2013年11月12日，俄罗斯一座核电厂也被震网病毒感染，
据报道这家俄罗斯核电站并没有接入互联网。

政府、公司行为：对个人隐私信息的窃取
新型软件威胁形态（二）
5•“棱镜门”事件（2013年6月5日）
•网络的背景流量中到底包含什么？

新型软件威胁形态（三）
公司行为：公司对用户的恶意骚扰以及对个人隐私信
息的窃取
6

新型软件威胁形态（四）
个人行为：黑客对公司、其他个人的攻击以及信息窃取

攻击者很容易针对软件漏洞发起攻击，使得系统崩溃或
发生非预期行为。
漏洞基本描述实例
缓冲区溢出程序对于向缓冲区写入超过缓冲区长度的数据没有做检查世界范围散播于Windows2000/XP的“冲击波蠕虫”，利用了Windows DCOM RPC服务
格式化字符串漏洞通过一些特殊的格式化符号，可以获取系统的信息、向堆栈放置数据利用Linux中
wu-ftpd2.6.0的漏洞可以执行任意的命令
整数溢出类型转换或者计算时赋予超过特定类型整形所能表达的数值范围Mac OSX 10.4 至10.5.1 中利用Mach-O装载程序的漏洞可以进行拒绝服务攻击
SQL注入程序对于用户的输入没有进行必要的验证和检查，直接用户数据库查询的参数利用相应的漏洞可以获取各种操作系统中的信息，甚至根用户的信息，控制整个计算机
各杀毒软件报告的“冲击波蠕虫”感染数量病毒公布三个月后，赛门铁克预估约有一百二十万台机器受到感染。
软件漏洞是最基本、最基础的安全威胁
8

操作系统软件安全分析
通过操作系统软件源码分析、行为分析和抗攻击能力分析，实现
操作系统安全可控。
源码分析
行为分析
抗攻击能力分析•静态检测
•代码审查
•安全机制
•动态检测
•污点分析
•模糊测试
•渗透测试
•攻防演练
•网战靶场开源软件
闭源软件
9

软件安全：
大环境带来大挑战
大势所趋！
10

趋势一：软件规模日益增大、发布日益频繁

趋势二：软件安全分析的内涵和外延不断发生变化（一）
操作系统的控制对象发生改变
12

趋势二：软件安全分析的内涵和外延不断发生变化（二）
传统软件安全的概念遭到颠覆
13

外延使用环境发生了变化，增加了更多隐私保护
的色彩；个别数据（比如位置）泄露不构成危害
，但对数据进行记录、整理、挖掘后会产生高价
值的情报或者隐私信息
趋势二：软件安全分析的内涵和外延不断发生变化（三）
14

开源社区一般较活跃、
使用中能及时发现漏洞
通过代码自动分析、扫
描发现隐藏漏洞
安全专家对核心代码进
行审查，发现深层次漏
洞
操作系统规模大、更新频
繁；文档支持不好；安全
专家只能审查极少一部分
代码
通过代码分析发现一些隐
藏、没有被发现的漏洞
恶意植入一些漏洞
开源软件安全分析的挑战
15

开源软件安全分析的挑战
“The NSA is quietly writing code for Google’s Android OS.”, 
Bloomberg BusinessWeek Technology, 2013-07-03.
Google spokeswoman Gina Sciglianoconfirms that the 
company has already inserted some of the NSA’s 
programming in Android OS. “All Android code and 
contributors are publicly available for review at 
source.android.com.” Scigliano says, declining to comment 
further. 
16

闭源软件安全分析的挑战
安全性主要依赖于软件
提供商的信誉
查找和发现隐藏的漏洞
比较困难
软件逆向会丢失信息
版权保护-防调试跟踪
安全机制的影响独立攻击者找到可以利用
的漏洞相对比较困难
“恶意”软件提供商
隐藏发现的漏洞
制造后门
容易
代价低
发现困难17

Windows操作系统中，对
于专门用于加密功能的库
中，保存有NSAKey，属于
NSA，至于这个
Key做什么
的，微软和NSA讳莫如深
闭源软件安全分析的挑战
18

软件安全性分析难度大
隐蔽性
一条错误指令隐藏在G为单位的指令序列中
可能的执行路径更是海量数据
复杂性
软件自身的复杂性
漏洞机理的复杂性
利用模式的复杂性
危害严重
首款曝光的网络战武器Stuxnet：漏洞是关键
漏洞是APT（Advanced Persistent Threat）攻击成功的主要条件
原因复杂
无意造成的错误
有意设计的后门
软件安全分析——难度
19

Binary Executable Transforms (BET) 
自动分析二进制代码并确定功能组件，自动切片并提取格式化的输入输出，综合利用静态、动态分析手段，提高对二进制代码的分析理解能力；利用形式化方法验证功能组件的相关属性，设计中间语言以支持程序切片等分析工作；研发相关的支撑性工具
VETTING COMMODITY IT SOFTWARE AND 
FIRMWARE (VET) 
具备对商业IT产品中可能存在的恶意功能的分析和检测能力;具备对IT产品中看似无意造成的漏洞（accidental-seeming ）、功能可能
存在的负面作用的分析能力；在对手恶意欺骗的情况下的漏洞、恶意行为的分析检测能力
CYBER GRAND CHALLENGE (CGC) 
网络安全挑战赛，重点内容包括软件的逆向分析、漏洞挖掘与利用等内容，以期发现系统的安全缺陷，探索安全防御措施
软件安全分析——国外相关项目
20

NSFC“可信软件基础研究”重大研究计划
“航天嵌入式软件可信性保障集成环境和示范验证与应用”
“可信嵌入式软件系统试验环境与示范应用”
“可信软件理论、方法集成与综合试验平台”
“基于认识与理解途径的度量与评估体系及支撑技术研究”
“面向软件可信性演进的软件测试技术研究”
“航天嵌入式软件可信性构造与验证的关键技术研究”
“基于测试的软件可信性增长模型及其评估方法研究”
“面向性质的可信软件建模与时序性质验证及支持工具”
“基于模型的嵌入式软件测试与验证技术及针对国产列车控制系统的实例研究”
“航天嵌入式软件缺陷检测方法研究、系统研发及应用”
…… 
软件安全分析——国内相关项目
21

程序分析要干什么
输入中的敏感信息是否会被输出？
输入中的不安全成份是否会传导到输出？
软件代码
软件代码
输入
输入
输
输
出
出
软件安全需要程序分析
22

软件安全需要程序分析
程序分析要干什么
如果不分析软件代码，只能相信
输入一定会传导到输出
如果代码作者声称考虑了隔离，则不会传导
如果作者声称没有考虑隔离，则会传导
但代码作者可能会出错，所以，程序分析有助于在更细
粒度上保护安全
23

24main(){
x=read();
y=f(x);
z=sanitize(y);
output(f(z));}
int f(int a){
return a;}
x
x
y
y
f
f
sanitize
z
z
o
o
软件安全需要程序分析
程序分析的起源
编译器
程序验证
程序分析不可能百分百准确
莱斯定理（Rice’s Theorem）
如何取舍
在保证分析效率前提下提高精度
分析效率的制约会产生大量误报

程序分析广泛地用在软件安全漏洞的检测中
某些程序分析方法可以达到很高的精度，在软件安全
漏洞的检测中效率不高
字符串分析
某些程序分析方法精度不高，可能成为软件安全漏洞
检测的瓶颈
指针指向分析，指针别名分析
软件安全需要程序分析
25

软件安全一般考虑实际软件系统的安全
软件安全中的攻与防
攻：给定一个软件系统，试图找到该系统的安全漏洞，
然后考虑如何利用
防：给定一个软件系统，试图证明该系统没有安全漏
洞，有漏洞则考虑修补
未知的安全漏洞
软件安全需要程序分析
26

软件安全保障的通用思路（当前策略）
努力寻找软件的安全漏洞
如果能找到安全漏洞
从“攻”的角度是发现了攻击机会
从“防”的角度是通过修复漏洞提升安全性
如果不能找到安全漏洞，则认为软件暂时是安全的
27
软件安全需要程序分析

我们带大家学习什么？
操作系统软件安全分析
第四章第一讲软件安全引言
第四章第二、三讲漏洞扫描技术
第五章第一讲漏洞分析基础
第五章第二讲针对二进制程序的漏洞分析技术
第五章第三讲基于智能灰盒测试的漏洞分析技术
第六章第一讲典型漏洞与缺陷建模
第六章第二讲针对源代码的漏洞分析技术
第六章第三讲基于符号执行的缺陷分析技术
使学生浅显地了解软件漏洞发现和分析过程，并初步掌
握工具调试、漏洞扫描和漏洞分析的综合能力
使学生明白：不懂攻击，何谈防守
28

课程前置要求
计算机体系结构
操作系统
数据结构
算法设计
熟练掌握一门编程语言，至少能读汇编
强烈找出程序线索的渴望！And, the most important......
29

要做的和不要做的
要做的
努力，掌握程度与投入时间成正比
主动，自学所需知识，所有黑客都是工作狂
协作，但不能指望同学/队友
不要做的
不可抑制的网上练手
挑战网侦警察的智商。。。
30

31

课程准备工作
PC机或笔记本电脑一台，内存最好不小于4G，能够
联网
安装虚拟机和Linux操作系统
常备电子版书籍
0day安全：软件漏洞分析技术（第2版）王清主编
软件漏洞分析技术吴世忠主编
most important: 网上资源
32

恭喜大家步入软件王国的玫瑰园……

目录
一．漏洞基础
二．漏洞的分类分级
三．漏洞数据库
四．漏洞扫描技术原理
五．常见漏洞扫描工具
2

3
漏洞基础
漏洞
也叫脆弱性（Vulnerability），是计算机系统在硬件、软件
和协议的具体实现或系统安全策略上存在可以利用的缺陷或
者不足。
漏洞被发现后，可能通过这个漏洞获得计算机系统的额外
权限，使攻击者能够在未授权的情况下访问或者破坏系统
，
从而危害计算机系统安全。
传统信息安全（系统）
进不来
拿不走
搞不乱
看不懂现在和未来的信息安全（数据
）
进不来
拿不走
搞不乱
看不懂

4
漏洞检测
对于网络信息系统的安全而言，仅具有事后追查或实时报
警功能的安全检测装备是不够的，还需要具备系统安全漏
洞扫描能力的事先检查型安全工具。
系统漏洞扫描
又称漏洞检测，即对重要网络信息系统进行检查，发现其中可被攻击者利用的漏洞。

5
漏洞产生的原因
漏洞的成因很多，一般有以下几类：
①网络协议漏洞
②应用软件系统漏洞
③配置不当引起的漏洞

6
①网络协议漏洞
TCP/IP协议组是目前使用最广泛的网络互连协议之一。
TCP/IP协议将网络互连和开放性作为首要考虑的问题，
而没有过多的考虑安全性。
TCP/IP协议族本身的不安全性，导致一系列基于TCP/IP
的网络服务的安全性也相当脆弱。
实例：针对TCP三次握手的拒绝服务攻击

7
②应用软件系统漏洞
任何一种软件系统都或多或少存在一定的脆弱性。
因为很多软件在设计时忽略或者很少考虑安全性问题。
应用软件系统的漏洞有两种：
由于操作系统本身设计缺陷带来的安全漏洞，这种漏洞将被运行在该系统上的应用程序所继承；
应用软件程序的安全漏洞。

8
③配置不当引起的漏洞
一些网络系统中忽略了安全策略的制定；
即使采取了一定的网络安全措施，但由于系统的安全配置
不合理或不完整，安全机制没有发挥作用；
如配置冲突等。
在网络系统发生变化后，由于没有及时更改系统的安全配
置而造成安全漏洞。
如数据库缺省口令等。

目录
一．漏洞基础
二．漏洞的分类分级
三．漏洞数据库
四．漏洞扫描技术原理
五．常见漏洞扫描工具
9

10
漏洞的分类
系统安全漏洞主要概括为以下几方面特征属性：
漏洞被攻击者利用的方式
漏洞形成的主要原因
漏洞对系统安全造成的直接威胁
漏洞的触发条件
漏洞的操作角度
漏洞的发生时序
可根据这几个方面对系统漏洞进行分类。

11
漏洞的分类
根据漏洞被攻击者利用的方式分为：
本地漏洞
攻击者是系统本地的合法用户或已经通过其他攻击方法获得
了本地权限的非法用户。
攻击者必须在本机拥有访问权限前提下才能发起攻击的漏洞。
典型的是本地权限提升漏洞，能让普通用户获得最高管理员
权限。
远程漏洞
攻击者能对连接在网络上的任意一台机器进行攻击。
可分为入侵攻击与破坏攻击两种方式。
这类漏洞危害极大，攻击者能随心所欲操作他人电脑。

12
漏洞的分类
根据漏洞形成的主要原因分为：
输入验证错误（Input Validation Error
）
缓冲区溢出（Buffer Overflow）
设计错误（Design Error
）
意外情况处置错误（Exceptional Condition Handling Error
）
访问验证错误（Access Validation Error
）
配置错误（Configuration Error
）
竞争条件（Race Condition）
环境错误（Condition Error
）

13
漏洞的分类
根据漏洞对系统安全造成的直接威胁分为：
普通用户访问权限
本地管理员权限
远程管理员权限
权限提升
本地拒绝服务
远程拒绝服务
服务器信息泄露
远程非授权文件存取
读取受限文件
口令恢复
欺骗

14
漏洞的分类
根据漏洞的触发条件分为：
主动触发漏洞
攻击者可以主动利用，如缓冲区溢出
被动触发漏洞
必须要计算机用户配合，如邮件链接触发（图片链接等）

漏洞的分类
根据漏洞的发生时序分为：
发布时间补丁
未公开漏洞
产生发现消亡
0day漏洞
1day漏洞
历史漏洞
15

16
漏洞的分级
漏洞分类是漏洞分级基础。
安全事件的处理方法要依据系统安全漏洞分级来制定。
根据漏洞对系统造成的潜在威胁（破坏性、危害性和严重
性）以及被利用的可能性为依据将系统安全漏洞分为四级
：
第一等级：紧急
第二等级：重要
第三等级：中等
第四等级：低等

17
第一等级：紧急
定义
对“紧急”级别漏洞的利用可以导致网络蠕虫和病毒在用户不
知情的情况下在网络上任意传播和繁殖。
对于被评为“紧急”的安全漏洞，需要立即安装升级包
（补丁程序）。

18
第二等级：重要
定义
对“重要”级别漏洞的利用可以导致严重的后果，以致危害到用
户数据、相关资源的机密性、完整性和有效性。
对于被评为“重要”的安全漏洞，需要安装升级包（补丁
程序）。

19
第三等级：中等
定义
由于默认配置、审核或难以利用等因素的影响，“中等”级别漏
洞的利用效果显著降低。
对于“中等”系统安全漏洞，应该在阅读安全信息以后判
断该安全漏洞是否对此系统产生影响。确认升级包不会影
响到系统之后，可以选择性安装。

20
第四等级：低等
定义
对于“低等”级别漏洞的利用效果己降至最低限度，漏洞利用难度非常大。
几乎所有用户都不会受到影响的安全性漏洞将被评级为
“低等”。
对于“低等”系统安全漏洞，仍需阅读安全信息判断是否
对此系统产生影响，并选择性安装升级包。

目录
一．漏洞基础
二．漏洞的分类分级
三．漏洞数据库
四．漏洞扫描技术原理
五．常见漏洞扫描工具
21

22
漏洞数据库
漏洞数据库的基本功能
帮助用户确认自身应用环境中可能存在的安全漏洞，提供基本漏
洞信息查询。
安全产品厂商可以基于持续更新的漏洞数据库和用户的应用布置
情况，为用户提供及时的安全预警。
为安全产品厂商基于安全漏洞发现和攻击保护类产品开发提供技
术和数据支持。

23
漏洞数据库的特点
一个好的漏洞数据库
覆盖面广
准确性高
及时性
完全性

24
漏洞数据库的详细信息
漏洞数据库一般包括
基本信息：漏洞名称、CVE编号、本地编号、发布/更新时间等
。
漏洞分类分级信息：漏洞级别/
类型、攻击类型/效果等。
参考资源信息：权威网站中与此漏洞相关的信息。
受影响的系统：此漏洞对哪些系统构成威胁的信息。
关键字：描述此漏洞最关键的信息。
补丁信息：漏洞补救方法、补丁信息和补丁下载地址信息等。

25
漏洞数据库的详细信息

26
CVE漏洞库
CVE是安全漏洞及其他信息安全风险标准名称的列表
，
目的是使所有已知漏洞和安全风险的名称标准化。
CVE是一个字典，对每种漏洞没有详细说明，但CVE
是构建权威漏洞库的标准。

27
漏洞数据库的表结构
CVE中漏洞数据库表应有的结构：

一个CVE实例
28

29
CVE的特点
一个漏洞有自己单独的名称；
对于目前出现的每个漏洞都进行了标准描述；
它是一个字典，而不是数据库；
能够让分开的数据库和安全工具用同一种语言“交谈”；
提供了一种协同工作的方式，使得安全覆盖面更广；
提供了安全工具和数据库安全评估的标准；
能方便地在互联网上下载和讨论；
通过CVE编辑板提交自己的定义，来寻求得到行业认可。

30
其它漏洞库
其它比较著名的网络安全公司或组织，如Security 
focus公司、ISS公司和AUSCERT等也都建立了自己
的漏洞数据库；
我国的中国国家信息安全漏洞库
、绿盟科技漏洞库
和
乌云平台
等。
http://www.wooyun.org/index.php
乌云平台
http://www.xfocus.net/index.html
Xfocus Team
http://www.securityfocus.com/
Security focus公司
https://www.auscert.org.au/1
AusCERT

目录
一．漏洞基础
二．漏洞的分类分级
三．漏洞数据库
四．漏洞扫描技术原理
五．常见漏洞扫描工具
31

32
扫描器基本概念
扫描器是一种自动检测远程或本地系统安全性弱点
（漏洞）的程序。
安全评估工具（防）
系统管理员保障系统安全的有效工具，目标可以是工作站、服务器、交换机、数据库应用等各种对象。
网络漏洞扫描器（攻）
网络入侵者收集信息的重要手段。
目前，没有一个漏洞扫描软件可以检测到网络上的全
部安全漏洞。因此，系统和网络管理人员最好采用多
种扫描软件和技术来确保网络安全。

扫描器基本工作流程
主机探测
端口扫描
漏洞扫描
识别系统及服务程序的类型
根据已知漏洞信息，分析系
统脆弱点
生成扫描结果报告
33

34
主机探测技术
主机探测的目的是确定在目标网络上的主机是否可达
，
这是信息收集的初级阶段，其效果直接影响到后续的
检测。
常用的传统主机探测手段
ICMP Echo扫描
ICMP Sweep扫描
Broadcast ICMP扫描
Non-Echo ICMP扫描

主机探测技术-ICMP协议
ICMP是IP协议的一部分，在IP协议栈中必须实现。
用途
网关或者目标机器利用ICMP与源通讯
当出现问题时，提供反馈信息用于报告错误
特点
不保证传输的可靠性
不用来反映ICMP报文的传输情况
35

主机探测技术-ICMP协议
36

37
主机探测技术-ICMP echo扫描
实现原理
Ping的实现机制，在判断在一个网络上主机是否开机时非常有用
。
向目标主机发送ICMP Echo Request (type 8)数据包，等待回复的ICMP Echo Reply 包(type 0) 。如果能收到，则表明目标系统
可达，否则表明目标系统已经不可达或发送的包被对方的设备过滤掉。
优点：简单，多种系统支持
缺点：很容易被防火墙限制
可以通过并行发送，同时探测多个目标主机，以提高探测效率（ICMP Sweep扫描）。

38
主机探测技术-Broadcast ICMP扫描
实现原理
将ICMP ECHO request包的目标地址设为广播地址或网络地址
，则可以探测广播域或整个网络范围内的主机。
缺点
只适于UNIX/Linux系统，Windows 会忽略这种请求包；
这种扫描方式容易引起广播风暴。

39
主机探测技术-Non-Echo ICMP扫描
一些其它ICMP类型包也可以用于对主机或网络设备
的探测。
Stamp Request(Type 13)
Reply(Type 14)
Information Request(Type 15)
Reply(Type 16)
Address Mask Request (Type 17)
Reply(Type 18)

40
主机探测技术－高级技术
防火墙和网络过滤设备常常导致传统的探测手段
变得无效。为了突破这种限制，必须采用一些非
常规的手段。
异常的IP包头
在IP头中设置无效的字段值
错误的数据分片
通过超长包探测内部路由器
反向映射探测

41
主机探测技术－高级技术
（1）异常的IP包头
向目标主机发送包头错误的IP包，目标主机或过滤设备会反馈
ICMP Parameter Problem Error
信息。常见的伪造错误字段为Header Length Field 和IP Options Field。
根据RFC1122的规定，主机应该检测IP包的Version Number
、Checksum字段，路由器应该检测IP包的Checksum字段。
不同厂家的路由器和操作系统对这些错误的处理方式不同，返回的结果也各异。如果结合其它手段，可以初步判断目标系统所在网络过滤设备的访问列表
ACL。

42
主机探测技术－高级技术
（2）在IP头中设置无效的字段值
向目标主机发送的IP包中填充错误的字段值，目标主机或过滤设备会反馈ICMP Destination Unreachable信息。这种方法同样可以探测目标主机和网络设备以及其ACL。
（3）错误的数据分片
当目标主机接收到错误的数据分片（如某些分片丢失），并且在规定的时间间隔内得不到更正时，将丢弃这些错误数据包，并向发送主机反馈ICMP Fragment Reassembly Time Exceeded 
错误报文。
利用这种方法同样可以检测到目标主机和网络过滤设备及其ACL。

43
主机探测技术－高级技术
（4）通过超长包探测内部路由器
若构造的数据包长度超过目标系统所在路由器的PMTU且设置禁止分片标志, 该路由器会反馈Fragmentation Needed and Don't Fragment Bit was Set差错报文，从而获取目标系统的网络拓扑结构。
（5）反向映射探测
该技术用于探测被过滤设备或防火墙保护的网络和主机。通常这些系统无法从外部直接到达。
想探测某个未知网络内部的结构时，可以构造可能的内部IP地址列表
，并向这些地址发送数据包。当对方路由器接收到这些数据包时，会进行IP识别并路由，对不在其服务的范围的IP包发送ICMP Host Unreachable或ICMP Time Exceeded 错误报文，没有接收到相应错误报文的IP地址会被认为在该网络中。
当然，这种方法也会受到过滤设备的影响。

44
端口扫描技术
当确定了目标主机可达后，就可以使用端口扫描技术，发现目标主机的开放
端口，包括网络协议和各种应用监听的端口。常见的端口扫描方式
开放式扫描技术TCP Connect( )扫描
TCP反向ident扫描半开放式扫描技术TCP SYN扫描
TCP间接扫描
隐蔽扫描技术TCP FIN扫描
TCP Null扫描
TCP Xmas扫描
TCP ftp proxy扫描
分段扫描其他TCP Maimon扫描
TCP Fragmentation 
UDP扫描

端口扫描技术--开放扫描
TCP Connect 扫描
实现原理
通过调用socket函数connect()连接到目标计算机上，完成一次
完整的三次握手过程。如果端口处于侦听状态，那么connect()就能成功返回。否则，这个端口不可用，
即没有提供服务。
优点
稳定可靠，不需要特殊的权限。
缺点
扫描方式不隐蔽，服务器日志会记录下大量密集的连接和错误记录，并容易被防火墙发现和屏蔽。
45

端口扫描技术--开放扫描
TCP反向ident
扫描
实现原理
ident协议允许看到通过TCP连接的任何进程的拥有者的用户名，即使这个连接不是由这个进程开始的。比如，连接到http端口，然后用identd来发现服务器是否正在以root权限运行。
缺点
只能在和目标端口建立了一个完整的TCP连接后才能看到。
46

47
端口扫描技术--半开放扫描
TCP SYN扫描
实现原理
首先扫描程序发送一个SYN数据包，假装要打开一个实际的
连接并等待反应。如果返回Synlack信息就表示端口处于侦听状态。如果返回RST
则表示端口没有处于侦听态。
假如收到一个Synlack，则扫描程序就发送一个RST信号来
关闭这个连接过程而不是发送ACK包。
这种技术通常认为是“半开放”扫描，因为它不完成一次完
整的TCP连接。
优点
一般不会在目标计算机上留下记录。
缺点
必须有管理员权限才能建立自己的SYN数据包。

端口扫描技术--半开放扫描
TCP间接扫描
实现原理
利用第三方的IP（欺骗主机）来隐藏真正扫描者的IP。由
于扫描主机会对欺骗主机发送回应信息，所以必须监控欺骗主机的
IP行为，从而获得原始扫描的结果。扫描主机通
过伪造第三方主机IP地址向目标主机发起SYN扫描，并通过观察其IP
序列号的增长规律获取端口的状态。
优点
隐蔽性好。
缺点
对第三方主机的要求较高。
48

49
端口扫描技术--隐蔽扫描
TCP FIN扫描
实现原理
通过向目标主机发送包含FIN标志的TCP包探测端口，如果被
探测的目标主机的端口处于关闭状态，则目标主机返回一个
RST信号；如果目标主机的端口处于侦听状态，则目标主机会
忽略对FIN数据包的回复，即主机不会返回RST信号。通过是
否返回RST信号，可以判定目标主机开放了哪些端口。
优点
由于不包含标准TCP三次握手协议的任何部分，所以无法被记
录下来，从而比SYN扫描隐蔽得多。
缺点
跟SYN扫描类似，需要自己构造数据包，要求由超级用户或者授权
用户访问专门的系统调用；通常适用于UNIX目标主机。在Windows95/NT环境下，该方法无效，
因为不论目标端口是否打开，操作系统都返回RST包。

端口扫描技术--隐蔽扫描
TCP Xmas 和TCPNull 扫描
实现原理
TCP Xmas和Null扫描是FIN扫描的两个变种。Xmas扫描
打开FIN，URG和PUSH标记，而Null扫描关闭所有标记。
这些组合的目的是为了通过对FIN标记数据包的过滤。当一
个这种数据包到达一个关闭的端口，数据包会被丢掉，并且
返回一个RST数据包。否则，若是打开的端口，数据包只是
简单的丢掉（不返回RST）。
优点
隐蔽性好。
缺点
需要自己构造数据包，要求由超级用户或者授权用户权限；
通常适用于UNIX目标主机，而Windows系统不支持。
50

端口扫描技术--隐蔽扫描
TCP ftp proxy扫描
实现原理：FTP代理连接选项，其目的是允许一个客户端同时跟两个FTP服务器建立连接，然后在服务器之间直接传输数据。然而，在大部分实现中，实际上能够使得FTP服务器发送文件到Internet的任何地方。其扫描步骤如下：
①假定S是扫描机，T是扫描目标，F是一个ftp服务器，这个服务器支持代理选项，能够跟S和T建立连接。
②S与F建立一个ftp会话，使用PORT命令声明一个选择的端口
（pT）作为代理传输所需要的被动端口。
③然后S使用一个LIST命令尝试启动一个到pT的数据传输。
④如果端口pT确实在监听，传输就会成功（返回码150和226被发送回给S），否则S回收到"425无法打开数据连接"的应答。
⑤S持续使用PORT和LIST命令，直到T上所有的选择端口扫描完毕
优点：FTP代理扫描不但难以跟踪，而且可以穿越防火墙。
缺点：一些ftp server
禁止这种特性。51

端口扫描技术--隐蔽扫描
分段扫描
实现原理
不直接发送TCP探测数据包，而是将数据包分成两个
较小的IP段。这样就将一个TCP头分成好几个数据包
，
从而包过滤器就很难探测到。
优点
隐蔽性好，可穿越防火墙。
缺点
可能被丢弃；
某些程序在处理这些小数据包时会出现异常。
52

53
漏洞扫描技术
漏洞扫描是指检测远程或本地系统存在的安全缺陷
。
网络安全漏洞扫描器是指在Internet
上通过向远程或
本地主机发送探测数据包，获取主机的响应，并根据
反馈的数据包，进行解包和分析，从而检测目标网络
或主机系统漏洞的程序。

54
漏洞扫描的主要功能
探测扫描目标主机并且对其工作状态进行识别；
对于正在运行的主机，能够识别开放的端口的状态及
提供的服务；
识别目标主机系统及服务程序的类型和版本，获取相
应主机的系统信息；
根据已知漏洞信息，进行脆弱性分析。

55
漏洞扫描的策略
被动式策略
主动式策略

56
漏洞扫描策略--被动式策略
被动式策略就是扫描基于主机之上，从一个内部用户的角
度来检测操作系统级的漏洞，主要用于检测注册表和用户
配置中的漏洞。
优点
能直接获取主机操作系统的底层细节，如特殊服务和配置的细节
等。
缺点
只有控制了目标主机，并将检测工具安装在目标主机，才能实施
正常的扫描活动。

57
漏洞扫描策略--主动式策略
主动式策略是基于网络的，通过执行一些脚本文件，模拟对系
统进行攻击并记录系统的反应，从而发现其安全漏洞，它从外
部攻击者的角度对网络及系统架构进行扫描，主要用于查找目
标开放的端口、提供的网络服务及协议中的漏洞。
优点
能够有效的发现那些基于主机的扫描所不能发现的网络设
备漏洞，如路由器、交换机、远程访问服务和防火墙等存在
的漏洞。

目录
一．漏洞基础
二．漏洞的分类分级
三．漏洞数据库
四．漏洞扫描技术原理
五．常见漏洞扫描工具
58

59
扫描工具
扫描器是一种自动检测远程或本地主机安全性弱点的程序
。
可以不留痕迹地发现远程服务器的各种TCP端口的分配、提
供的服务及软件版本，从而间接或直观地了解到远程主机存在的安全问题。
功能：主机扫描、端口扫描和服务扫描等。
常用的有Nmap、X
-Scan、Fluxay、Nessus等。

扫描器分类
漏洞扫描器在网络安全的发展中出现了各种各样的版
本，功能从单一到复杂，从本地安全探测到远程的安
全探测。一般地，从扫描器的探测功能来说，可以分
为以下几类：
网络扫描器
主机扫描器
服务扫描器
数据库扫描器
专用扫描器

扫描器分类
1.网络扫描器
模拟攻击者对目标网络进行攻击探测，找出目标存在的脆弱点。网络扫描器针对远程主机(网络)进行探测，有很大的灵活性，适用性广。
比如，目前应用比较广泛的网络漏洞扫描工具之一Nessus。
2.主机扫描器
针对本地主机，以本地主机作为探测目标，找出本地主机的脆弱点，
以防止被攻击者利用。主机扫描器需要与本地操作系统的版本相适应，对本地主机可以进行高准确性的探测，可以探测出详细的安全补丁情况，存在脆弱点的服务以及口令和其他一些关于服务的配置信息。

扫描器分类
3.服务扫描器
探测目标主机开放端口来分析目标可能运行的服务，并以此为依据检测可能被利用的攻击入口等
4.数据库扫描器
专门针对数据库的弱点探测工具，主要从数据库的认证、授权、系统集成、基线比较等方面进行分析
5.专用扫描器
专门针对某一漏洞或者服务相关信息收集的扫描器，如CGI扫描、ASP等脚本的扫描、操作系统识别等功能比较专一的扫描器

评价扫描器的原则
漏洞检测的完整性
是否能扫描各类重要的系统漏洞，漏洞库信息的完备程度如何？
漏洞检测的精确性是否能准确报告系统漏洞，很少误报或漏报。
漏洞检测的范围
是否能进行本地主机或远端主机的扫描。
及时更新
是否能及时更新漏洞库，加入新发现的漏洞信息。
报告功能
是否有完善的报告功能，使客户便于理解和维护。
价格
产品价格是否合理。
63

扫描器一般结构
64基于B/S结构
扫描器运行平台可以是Linux、UNIX和Windows操作系统
建有漏洞库
控制平台则提供一个人机交互的界面

扫描器一般流程和功能
采用多种扫描规避和隐蔽技术，扫描目标主机和端口，
识
别其工作状态；
识别目标主机系统及服务程序的类型和版本；
根据漏洞库信息，分析系统脆弱点；
提供漏洞产生背景、影响、攻击方式、修补措施等信息；
以网页形式生成扫描结果报告；
提供用户动态加载和扩充系统的接口（可扩展性）。
65

常用工具——Nmap
Nmap (Network Mapper
，网络映射器) 是一款开放源代码的网络探
测和安全审核的工具。设计目标是快速地扫描大型网络，也可扫描单个主机。
Nmap的功能是发现目标机的详细信息
提供的服务(应用程序名和版本)
操作系统(包括版本信息)
报文过滤器/防火墙类型
域名、设备类型和MAC地址等
Nmap通常用于安全审核和一些日常工作
查看整个网络的信息
管理服务升级计划
监视主机和服务的运行
66

67
常用工具——X-Scan 
X-Scan是国内著名网络安全组织“安全焦点”开发的综
合扫描工具。
采用多线程方式对指定IP地址段(或单机)进行安全漏洞检测；
支持插件功能；
提供了图形界面和命令行两种操作方式。
扫描内容
包括远程服务类型、操作系统类型及版本，各种弱口令漏洞、后门、应用服务漏洞、网络设备漏洞、拒绝服务漏洞等二十几个大类。
对于多数已知漏洞，给出了相应的漏洞描述、解决方案及
详细描述链接。

发展
从1998年开发至今，架构成熟。
Nessus 被认为是目前全世界最多人使用的系统漏洞扫描与分析软件。
Nessus第三版本以前为开放源码，最新版本为Nessus 6.2，windows、
Linux等系统上皆可使用。
使用
Nessus对个人用户是免费的，只需在官方网站上填邮箱，就能收到注册号；
对商业用户是收费的。
资料
官网：http://www.tenable.com/products/nessus
安装手册
http://static.tenable.com/documentation/nessus_6.2_installation_guide.
pdf
用户指南
http://static.tenable.com/documentation/nessus_6.2_user_guide.pdf


